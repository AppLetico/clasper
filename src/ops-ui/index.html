<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clasper Ops Console</title>
    <link rel="icon" type="image/svg+xml" href="/ops/favicon.svg">
    <link rel="alternate icon" href="/ops/favicon.ico">
    <link rel="stylesheet" href="/ops/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <div class="brand-block">
          <div class="brand-logo">
            <svg width="24" height="24" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <path id="clasper-logo-h1" d="M 35 26 L 55.78 38 L 55.78 62 L 35 74 L 14.22 62 L 14.22 38 Z" />
                <path id="clasper-logo-h2" d="M 65 26 L 85.78 38 L 85.78 62 L 65 74 L 44.22 62 L 44.22 38 Z" />
                <mask id="clasper-logo-cut-h1">
                  <rect width="100" height="100" fill="white" />
                  <path d="M 65 74 L 44.22 62" stroke="black" stroke-width="16" />
                </mask>
                <mask id="clasper-logo-cut-h2">
                  <rect width="100" height="100" fill="white" />
                  <path d="M 35 26 L 55.78 38" stroke="black" stroke-width="16" />
                </mask>
              </defs>
              <use href="#clasper-logo-h1" mask="url(#clasper-logo-cut-h1)" />
              <use href="#clasper-logo-h2" mask="url(#clasper-logo-cut-h2)" />
            </svg>
          </div>
          <div class="brand-text">
            <div class="brand-name">Clasper</div>
            <div class="brand-subtitle">Ops Console</div>
          </div>
        </div>
        
        <nav class="nav">
          <div class="nav-group-label">Platform</div>
          <a class="nav-link active" href="#dashboard" data-nav="dashboard">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            Dashboard
          </a>
          <a class="nav-link" href="#traces" data-nav="traces">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            Traces
          </a>
          <a class="nav-link" href="#workspaces" data-nav="workspaces">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
            Workspaces
          </a>
          
          <div class="nav-group-label">Registry</div>
          <a class="nav-link" href="#skills" data-nav="skills">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
            Skills
          </a>
          <a class="nav-link" href="#adapters" data-nav="adapters">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            Adapters
          </a>

          <div class="nav-group-label">Governance</div>
          <a class="nav-link" href="#policies" data-nav="policies">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            Policies
          </a>
          <a class="nav-link" href="#approvals" data-nav="approvals">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>
            Approvals
            <span id="pendingBadge" class="nav-badge hidden">0</span>
          </a>
          <a class="nav-link" href="#audit" data-nav="audit">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            Audit
          </a>
        </nav>
        
        <div class="sidebar-footer">
          <div class="user-block">
            <div class="user-avatar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            </div>
            <div class="user-info">
              <div id="authStatusCompact" class="user-role">Not authenticated</div>
              <button id="toggleAuth" class="btn-link">Enter Token</button>
            </div>
          </div>
        </div>
      </aside>

      <div class="main">
        <header class="topbar">
          <div class="topbar-content">
            <div class="breadcrumbs">
              <span class="breadcrumb-root">Clasper</span>
              <span class="breadcrumb-sep">/</span>
              <h1 id="pageTitle" class="breadcrumb-current">Dashboard</h1>
            </div>
            
            <div class="topbar-actions">
              <div class="health-badge" id="healthBadge">
                <span id="healthDot" class="health-dot"></span>
                <span id="healthText">Checking...</span>
              </div>
              
              <div id="authPanel" class="auth-dropdown hidden">
                <div class="auth-dropdown-header">Authentication</div>
                <div class="auth-dropdown-body">
                  <input id="tokenInput" type="password" placeholder="Paste OIDC access token" />
                  <button id="saveToken" class="btn-primary w-full">Sign In</button>
                </div>
              </div>
            </div>
          </div>
        </header>

        <main class="content-scroll">
          <div class="content-container">
            <!-- Dashboard View -->
            <section class="view active" data-view="dashboard">
              <div class="dashboard-grid">
                <div class="stat-card">
                  <div class="stat-icon info">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><activity path="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Traces Today</div>
                    <div id="metricTracesToday" class="stat-value">-</div>
                    <div id="metricTraceBreakdown" class="stat-meta">Loading...</div>
                  </div>
                </div>
                
                <div class="stat-card">
                  <div class="stat-icon warn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Risk Score</div>
                    <div id="metricRiskSummary" class="stat-value">-</div>
                    <div id="metricRiskBreakdown" class="stat-meta">Loading...</div>
                  </div>
                </div>

                <div class="stat-card">
                  <div class="stat-icon success">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Cost (7d)</div>
                    <div id="metricCost" class="stat-value">-</div>
                    <div id="metricCostBars" class="spark-bars"></div>
                  </div>
                </div>

                <div class="stat-card">
                  <div class="stat-icon primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>
                  </div>
                  <div class="stat-content">
                    <div class="stat-label">Approvals</div>
                    <div id="metricApprovals" class="stat-value">-</div>
                    <div id="metricApprovalsHint" class="stat-meta">Loading...</div>
                  </div>
                </div>
              </div>

              <div class="section-grid">
                <div class="panel">
                  <div class="panel-header">
                    <h3>Recent High Risk Traces</h3>
                    <button id="refreshDashboard" class="btn-icon" title="Refresh">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                    </button>
                  </div>
                  <div id="highRiskList" class="panel-list empty-state">
                    No high risk traces found.
                  </div>
                </div>

                <div class="panel">
                  <div class="panel-header">
                    <h3>System Health</h3>
                  </div>
                  <div id="healthPanel" class="health-grid">
                    <div class="spinner"></div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Traces View -->
            <section class="view" data-view="traces">
              <div class="panel full-height">
                <div class="toolbar">
                  <div class="toolbar-group">
                    <input id="tenantFilter" class="input-sm" placeholder="Tenant ID" />
                    <input id="workspaceFilter" class="input-sm" placeholder="Workspace ID" />
                    <select id="statusFilter" class="select-sm">
                      <option value="">Status: All</option>
                      <option value="success">Success</option>
                      <option value="error">Error</option>
                    </select>
                    <select id="riskFilter" class="select-sm">
                      <option value="">Risk: All</option>
                      <option value="low">Low</option>
                      <option value="medium">Medium</option>
                      <option value="high">High</option>
                      <option value="critical">Critical</option>
                    </select>
                    <button id="searchTraces" class="btn-primary btn-sm">Search</button>
                    <button id="resetTraces" class="btn-ghost btn-sm">Reset</button>
                  </div>
                  <div class="toolbar-group">
                     <button id="refreshTraces" class="btn-icon">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                    </button>
                  </div>
                </div>

                <div class="table-container">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th data-sort="id">Trace ID</th>
                        <th data-sort="environment">Env</th>
                        <th data-sort="agent_role">Role</th>
                        <th data-sort="status">Status</th>
                        <th data-sort="risk">Risk</th>
                        <th data-sort="trust_status">Trust</th>
                        <th data-sort="cost" class="text-right">Cost</th>
                        <th data-sort="duration_ms" class="text-right">Dur</th>
                      </tr>
                    </thead>
                    <tbody id="traceTable"></tbody>
                  </table>
                </div>
                
                <div class="pagination-bar">
                  <div class="pagination-info">Showing <span id="tracePageInfo">Page 1</span></div>
                  <div class="pagination-controls">
                    <button id="tracePrev" class="btn-secondary btn-sm" disabled>Previous</button>
                    <button id="traceNext" class="btn-secondary btn-sm">Next</button>
                    <select id="tracePageSize" class="select-sm">
                      <option value="25">25 / page</option>
                      <option value="50" selected>50 / page</option>
                      <option value="100">100 / page</option>
                    </select>
                  </div>
                </div>
              </div>
            </section>

            <!-- Workspaces View -->
            <section class="view" data-view="workspaces">
              <div class="grid-2">
                <div class="panel">
                  <div class="panel-header">
                    <h3>Promotions</h3>
                    <div class="badge-pill">Pipeline</div>
                  </div>
                  <div class="panel-body">
                    <div class="form-group">
                      <label>Workspace & Environment</label>
                      <div class="input-group">
                        <input id="promoWorkspace" placeholder="Workspace ID" />
                        <input id="promoSource" placeholder="Source (e.g. dev)" />
                        <input id="promoTarget" placeholder="Target (e.g. prod)" />
                      </div>
                    </div>
                    <div class="form-actions">
                      <button id="runPromotionCheck" class="btn-secondary">Run Pre-flight Checks</button>
                    </div>
                    
                    <div id="promotionResult" class="result-box hidden"></div>
                    
                    <div class="divider"></div>
                    
                    <div class="form-group">
                      <label>Execution</label>
                      <input id="promoAnnotation" placeholder="Required annotation note..." />
                      <label class="checkbox-wrapper">
                        <input id="promoOverride" type="checkbox" />
                        <span class="checkbox-label">Request override if blocked</span>
                      </label>
                    </div>
                    <button id="runPromotionExecute" class="btn-primary w-full">Execute Promotion</button>
                  </div>
                </div>

                <div class="panel">
                  <div class="panel-header">
                    <h3>Rollback</h3>
                    <div class="badge-pill warn">Emergency</div>
                  </div>
                  <div class="panel-body">
                    <div class="form-group">
                      <label>Workspace</label>
                      <div class="input-group">
                        <input id="rollbackWorkspace" placeholder="Workspace ID" />
                        <button id="loadVersions" class="btn-secondary">Load Versions</button>
                      </div>
                    </div>
                    
                    <div id="versionList" class="list-box">
                      <div class="empty-text">Load versions to select a rollback target.</div>
                    </div>
                    
                    <div class="form-group mt-4">
                      <label>Target Version</label>
                      <input id="rollbackVersion" placeholder="Version Hash" class="mono" />
                    </div>
                    <div class="form-group">
                      <label>Annotation</label>
                      <input id="rollbackAnnotation" placeholder="Reason for rollback..." />
                    </div>
                    <button id="runRollback" class="btn-danger w-full">Execute Rollback</button>
                  </div>
                </div>
              </div>
            </section>

            <!-- Skills View -->
            <section class="view" data-view="skills">
              <div class="grid-layout">
                <div class="panel">
                  <div class="panel-header">
                    <h3>Skill Registry</h3>
                    <div class="search-box">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                      <input id="skillSearch" placeholder="Search skills..." />
                    </div>
                  </div>
                  <div class="panel-body p-0">
                    <button id="loadSkills" class="hidden"></button>
                    <div id="skillList" class="list-group">
                      <div class="empty-state"><div class="spinner"></div></div>
                    </div>
                  </div>
                </div>
                
                <div class="panel side-panel">
                  <div class="panel-header">
                    <h3>Manage Skill</h3>
                  </div>
                  <div class="panel-body">
                    <div class="form-group">
                      <label>Skill Name</label>
                      <input id="skillName" placeholder="e.g. web-scraper" />
                    </div>
                    <div class="form-group">
                      <label>Version</label>
                      <input id="skillVersion" placeholder="e.g. 1.0.0" />
                    </div>
                    <div class="form-group">
                      <label>Target State</label>
                      <select id="skillState">
                        <option value="active">Active</option>
                        <option value="deprecated">Deprecated</option>
                        <option value="experimental">Experimental</option>
                      </select>
                    </div>
                    <button id="promoteSkill" class="btn-primary w-full">Update State</button>
                  </div>
                </div>
              </div>
            </section>

            <!-- Policies View -->
            <section class="view" data-view="policies">
              <div class="grid-layout">
                <div class="panel">
                  <div class="panel-header">
                    <h3>Active Policies</h3>
                    <button id="loadPolicies" class="btn-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button>
                  </div>
                  <div id="policiesList" class="policy-list">
                    <div class="empty-state">No policies loaded.</div>
                  </div>
                </div>

                <div class="panel side-panel">
                  <div class="panel-header">
                    <h3>Editor</h3>
                    <div class="tabs">
                      <button class="tab active">Edit</button>
                      <button class="tab">Dry Run</button>
                    </div>
                  </div>
                  <div class="panel-body">
                    <div class="form-group">
                      <label>Tenant Scope</label>
                      <input id="policyTenant" placeholder="Tenant ID" />
                    </div>
                    <div class="form-group flex-1">
                      <label>Policy JSON</label>
                      <textarea id="policyJson" class="code-editor" placeholder="{ ... }"></textarea>
                    </div>
                    <button id="savePolicy" class="btn-primary w-full">Save Policy</button>
                    
                    <div class="divider"></div>
                    
                    <div class="form-group">
                      <label>Dry Run Input</label>
                      <textarea id="policyDryRunJson" class="code-editor small" placeholder="Request context JSON..."></textarea>
                    </div>
                    <button id="runPolicyDryRun" class="btn-secondary w-full">Test Policy</button>
                    <div id="policyDryRunResult" class="result-box hidden"></div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Adapters View -->
            <section class="view" data-view="adapters">
              <div class="grid-2">
                <div class="panel">
                  <div class="panel-header">
                    <h3>Registered Adapters</h3>
                    <button id="loadAdapters" class="btn-secondary btn-sm">Refresh</button>
                  </div>
                  <div id="adapterList" class="card-list">
                    <div class="empty-state">No adapters found.</div>
                  </div>
                </div>
                
                <div class="panel">
                  <div class="panel-header">
                    <h3>Key Management</h3>
                  </div>
                  <div class="panel-body">
                    <div class="form-group">
                      <label>Adapter Identity</label>
                      <div class="input-group">
                        <input id="adapterKeyTenant" placeholder="Tenant" />
                        <input id="adapterKeyId" placeholder="Adapter ID" />
                        <input id="adapterKeyVersion" placeholder="Version" />
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Key Configuration</label>
                      <div class="input-group">
                        <input id="adapterKeyAlg" placeholder="Alg (ES256)" />
                        <input id="adapterKeyIdValue" placeholder="Key ID (kid)" />
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Public JWK</label>
                      <textarea id="adapterKeyJwk" class="code-editor small" placeholder="{ kty: ... }"></textarea>
                    </div>
                    <button id="saveAdapterKey" class="btn-primary w-full">Register Key</button>
                    
                    <div class="divider"></div>
                    
                    <div class="form-group">
                      <label>Revocation</label>
                      <input id="adapterKeyRevokeReason" placeholder="Reason for revocation..." />
                    </div>
                    <button id="revokeAdapterKey" class="btn-danger w-full">Revoke Key</button>
                  </div>
                </div>
              </div>
            </section>

            <!-- Approvals View -->
            <section class="view" data-view="approvals">
              <div class="panel">
                <div class="panel-header">
                  <h3>Pending Decisions</h3>
                  <button id="loadDecisions" class="btn-secondary btn-sm">Refresh Queue</button>
                </div>
                <div id="decisionList" class="decision-grid">
                  <div class="empty-state">
                    <div class="empty-icon">âœ“</div>
                    <div>No pending approvals</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Audit View -->
            <section class="view" data-view="audit">
              <div class="panel">
                <div class="toolbar">
                  <input id="auditTenant" class="input-sm" placeholder="Tenant" />
                  <input id="auditWorkspace" class="input-sm" placeholder="Workspace" />
                  <input id="auditEventType" class="input-sm" placeholder="Event Type" />
                  <input id="auditStartDate" type="date" class="input-sm" />
                  <button id="loadAudit" class="btn-primary btn-sm">Search Log</button>
                </div>
                <div class="table-container">
                  <div id="auditList" class="audit-log">
                    <div class="empty-state">No audit events loaded.</div>
                  </div>
                </div>
              </div>
              
              <div class="panel mt-4">
                <div class="panel-header">
                  <h3>Compliance Exports</h3>
                </div>
                <div class="panel-body">
                  <div class="export-row">
                    <div class="export-info">
                      <strong>Audit Chain</strong>
                      <p>Cryptographically linked chain of all governance decisions.</p>
                    </div>
                    <button id="exportAuditChain" class="btn-secondary">Download Chain</button>
                  </div>
                  <div class="divider"></div>
                  <div class="export-row">
                    <div class="export-info">
                      <strong>Trace Bundle</strong>
                      <p>Full portable export of trace data and artifacts.</p>
                    </div>
                    <div class="export-actions">
                      <input id="exportTraceId" class="input-sm" placeholder="Optional Trace ID" />
                      <button id="exportBundle" class="btn-primary">Create Bundle</button>
                    </div>
                  </div>
                  <div id="exportStatus" class="status-text hidden"></div>
                </div>
              </div>
              
               <div class="panel mt-4">
                  <div class="panel-header">
                    <h3>Tool Authorizations</h3>
                     <button id="loadToolAuth" class="btn-secondary btn-sm">Load</button>
                  </div>
                  <div id="toolAuthList" class="list-group">
                     <div class="empty-state">No authorizations found.</div>
                  </div>
               </div>
            </section>
          </div>
        </main>
      </div>
    </div>

    <!-- Trace Detail Drawer -->
    <div id="traceDrawer" class="drawer">
      <div class="drawer-header">
        <h3>Trace Detail</h3>
        <div class="drawer-actions">
          <button id="runDiff" class="btn-secondary btn-sm">Diff</button>
          <button id="closeTraceDrawer" class="btn-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
      </div>
      <div id="traceDetail" class="drawer-body">
        <div class="empty-state"><div class="spinner"></div></div>
      </div>
    </div>
    <div id="traceDrawerBackdrop" class="drawer-backdrop"></div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Override Modal -->
    <div id="overrideModal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog">
        <div class="modal-header">
          <h3>Override Required</h3>
          <button id="overrideModalClose" class="btn-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        </div>
        <div class="modal-body">
          <div class="alert warn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            <p class="modal-message">This action requires a structured override with justification.</p>
          </div>
          <div class="form-group">
            <label>Reason Code</label>
            <select id="overrideReasonCode">
              <option value="">Select a reason...</option>
              <option value="incident_response">Incident Response</option>
              <option value="hotfix">Hotfix</option>
              <option value="business_deadline">Business Deadline</option>
              <option value="data_correction">Data Correction</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Justification</label>
            <textarea id="overrideJustification" rows="3" placeholder="Explain why this override is necessary (min 10 chars)..."></textarea>
          </div>
          <div id="overrideError" class="error-message hidden"></div>
        </div>
        <div class="modal-footer">
          <button id="overrideCancel" class="btn-ghost">Cancel</button>
          <button id="overrideConfirm" class="btn-danger">Confirm Override</button>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog small">
        <div class="modal-header">
          <h3 id="confirmTitle">Confirm Action</h3>
          <button id="confirmClose" class="btn-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        </div>
        <div class="modal-body">
          <div id="confirmMessage">Are you sure?</div>
        </div>
        <div class="modal-footer">
          <button id="confirmCancel" class="btn-ghost">Cancel</button>
          <button id="confirmAccept" class="btn-primary">Confirm</button>
        </div>
      </div>
    </div>

    <script src="/ops/app.js"></script>
  </body>
</html>